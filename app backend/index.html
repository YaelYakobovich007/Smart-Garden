<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Smart Garden â€“ Register + Login</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <h1>ğŸŒ¿ Smart Garden</h1>

  <!-- REGISTER -->
  <h2>ğŸ†• Register with Email</h2>
  <input id="register-email" type="email" placeholder="Email" />
  <input id="register-password" type="password" placeholder="Password" />
  <br><br>
  <button onclick="register()">Register</button>

  <hr>

  <!-- LOGIN -->
  <h2>ğŸ” Login with Email</h2>
  <input id="login-email" type="email" placeholder="Email" />
  <input id="login-password" type="password" placeholder="Password" />
  <br><br>
  <button onclick="login()">Login</button>

  <hr>

  <!-- GOOGLE LOGIN -->
  <h2>ğŸ”“ Or continue with Google</h2>
  <div id="g_id_onload"
       data-client_id="883722498169-aqp6oi2tmplgecpnus3acde813hp6emg.apps.googleusercontent.com"
       data-callback="handleGoogleLogin">
  </div>

  <div class="g_id_signin"
       data-type="standard"
       data-size="large"
       data-theme="outline"
       data-text="continue_with"
       data-shape="rectangular">
  </div>

  <hr>
  <pre id="log"></pre>

  <script>
    const socket = new WebSocket('ws://192.168.68.74:8080');

    socket.onopen = () => {
      log('âœ… Connected to server');
      socket.send(JSON.stringify({ type: 'HELLO_USER' }));
    };

    socket.onmessage = (event) => {
      const data = JSON.parse(event.data);
      log('ğŸ“© From server:\n' + JSON.stringify(data, null, 2));
    };

    socket.onclose = () => {
      log('âŒ Disconnected from server');
    };

    socket.onerror = (err) => {
      log('ğŸš« Error: ' + err.message);
    };

    function register() {
      const email = document.getElementById('register-email').value;
      const password = document.getElementById('register-password').value;

      if (!email || !password) {
        log('âš ï¸ Please enter both email and password.');
        return;
      }

      socket.send(JSON.stringify({
        type: 'REGISTER',
        email,
        password
      }));
      log('ğŸ“¤ Sent register request');
    }

    function login() {
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;

      if (!email || !password) {
        log('âš ï¸ Please enter both email and password.');
        return;
      }

      socket.send(JSON.stringify({
        type: 'LOGIN',
        email,
        password
      }));
      log('ğŸ“¤ Sent login request');
    }

    function handleGoogleLogin(response) {
      const idToken = response.credential;
      socket.send(JSON.stringify({
        type: 'LOGIN_GOOGLE',
        googleToken: idToken
      }));
      log('ğŸ“¤ Sent Google login token to server');
    }
    window.handleGoogleLogin = handleGoogleLogin;

    function log(msg) {
      document.getElementById('log').textContent += msg + '\n';
    }
  </script>
</body>
</html>
